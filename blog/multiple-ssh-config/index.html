<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Using multiple SSH configurations for git operations ::
        jaanhio
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Some of you may be using multiple Github accounts and might have faced several permission related issues while setting up your SSH configuration to access private repositories from both accounts:
ERROR: Repository not found. fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists. git@github.com: Permission denied (publickey). fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists."
/>
<meta
  name="keywords"
  content="git, ssh, guide"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/blog/multiple-ssh-config/" />





<link rel="stylesheet" href="/assets/style.css" />

<link rel="stylesheet" href="/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Using multiple SSH configurations for git operations">
  <meta name="twitter:description" content="Guide to setting up multiple SSH configurations for git operations">



<meta property="og:url" content="/blog/multiple-ssh-config/">
  <meta property="og:site_name" content="jaanhio">
  <meta property="og:title" content="Using multiple SSH configurations for git operations">
  <meta property="og:description" content="Guide to setting up multiple SSH configurations for git operations">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2022-02-27T09:58:43+08:00">
    <meta property="article:modified_time" content="2022-02-27T09:58:43+08:00">
    <meta property="article:tag" content="Git">
    <meta property="article:tag" content="Ssh">
    <meta property="article:tag" content="Guide">



<meta name="description" content="I write about tech and more!" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >$</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About me</a></li>
        
      
        
          <li><a href="/collection">Collection</a></li>
        
      
        
          <li><a href="/moments">Moments</a></li>
        
      
        
          <li><a href="/projects">Projects</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About me</a></li>
      
    
      
        <li><a href="/collection">Collection</a></li>
      
    
      
        <li><a href="/moments">Moments</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Using multiple SSH configurations for git operations</h1>
    <div class="post-meta">
      
        <span class="post-date">
          6 Feb 2022
        </span>

        
          
        
      

      


      
        <span class="post-read-time"
          >— 6 min read</span
        >
      
    </div>

    
      <span class="post-tags">
        
          <a href="/tags/git/">#git</a>&nbsp;
        
          <a href="/tags/ssh/">#ssh</a>&nbsp;
        
          <a href="/tags/guide/">#guide</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p>Some of you may be using multiple Github accounts and might have faced several permission related issues while setting up your SSH configuration to access private repositories from both accounts:</p>
<pre tabindex="0"><code>ERROR: Repository not found.
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
</code></pre><pre tabindex="0"><code>git@github.com: Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
</code></pre><p>I tried several solutions found all over the internet but all seems to missing some additional configuration to make it work as expected.</p>
<p>Eventually I figured out the neccessary configuration to make it work and thought it will be good to document it down for my future self.</p>
<hr>
<h1 id="working-configuration">Working configuration</h1>
<p>Let&rsquo;s say you have 2 SSH keys setup <code>id_ed25519_id1</code> and <code>id_ed25519_id2</code>.</p>
<pre tabindex="0"><code># Account 1
Host github.com
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519_id1
  IdentitiesOnly yes
# Account 2
Host personal
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519_id2
  IdentitiesOnly yes
</code></pre><p>Now if you wish to clone a private repository from <code>Account 1</code>, run:</p>
<pre tabindex="0"><code>git clone git@github.com:account1/account1.github.io.git
</code></pre><p>For cloning a private repository from <code>Account 2</code>, run:</p>
<pre tabindex="0"><code>git clone git@personal:account2/account2.github.io.git
</code></pre><p>Take note that with this approach, the hostname of the <code>url</code> used has to be changed accordingly.</p>
<hr>
<h1 id="how-does-it-work">How does it work?</h1>
<p>When we perform a <code>git clone</code> operation using SSH, <code>git</code> actually uses <code>ssh-agent</code> to perform <code>ssh</code>, and we can override the SSH command using <code>GIT_SSH_COMMAND</code> flag to increase the verbosity and see what happens under the hood.</p>
<pre tabindex="0"><code>GIT_SSH_COMMAND=&#34;ssh -v&#34; git clone git@personal:account2/account2.github.io.git
</code></pre><p>Output:</p>
<pre tabindex="0"><code>Cloning into &#39;account2.github.io&#39;...
OpenSSH_8.6p1, LibreSSL 2.8.3
debug1: Reading configuration data /Users/foo/.ssh/config
debug1: /Users/foo/.ssh/config line 6: Applying options for personal &lt;----------------------------- found a matching Host from .ssh/config file
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: /etc/ssh/ssh_config line 21: include /etc/ssh/ssh_config.d/* matched no files
debug1: /etc/ssh/ssh_config line 54: Applying options for *
debug1: Authenticator provider $SSH_SK_PROVIDER did not resolve; disabling
debug1: Connecting to github.com port 22.
debug1: Connection established.
debug1: identity file /Users/foo/.ssh/id_ed25519_id2 type 3 &lt;------------------------------------------------ identified the identity file
debug1: identity file /Users/foo/.ssh/id_ed25519_id2-cert type -1 
debug1: Local version string SSH-2.0-OpenSSH_8.6
debug1: Remote protocol version 2.0, remote software version babeld-34bf8ec8
debug1: compat_banner: no match: babeld-34bf8ec8
debug1: Authenticating to github.com:22 as &#39;git&#39;
debug1: load_hostkeys: fopen /Users/foo/.ssh/known_hosts2: No such file or directory
debug1: load_hostkeys: fopen /etc/ssh/ssh_known_hosts: No such file or directory
debug1: load_hostkeys: fopen /etc/ssh/ssh_known_hosts2: No such file or directory
debug1: SSH2_MSG_KEXINIT sent
debug1: SSH2_MSG_KEXINIT received
debug1: kex: algorithm: curve25519-sha256
debug1: kex: host key algorithm: ssh-ed25519
debug1: kex: server-&gt;client cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none
debug1: kex: client-&gt;server cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none
debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
debug1: SSH2_MSG_KEX_ECDH_REPLY received
debug1: Server host key: ssh-ed25519 SHA256:xxxxxxx
debug1: load_hostkeys: fopen /Users/foo/.ssh/known_hosts2: No such file or directory
debug1: load_hostkeys: fopen /etc/ssh/ssh_known_hosts: No such file or directory
debug1: load_hostkeys: fopen /etc/ssh/ssh_known_hosts2: No such file or directory
debug1: Host &#39;github.com&#39; is known and matches the ED25519 host key.
debug1: Found key in /Users/foo/.ssh/known_hosts:3
debug1: rekey out after 134217728 blocks
debug1: SSH2_MSG_NEWKEYS sent
debug1: expecting SSH2_MSG_NEWKEYS
debug1: SSH2_MSG_NEWKEYS received
debug1: rekey in after 134217728 blocks
debug1: Will attempt key: /Users/foo/.ssh/id_ed25519_id2 ED25519 SHA256:xxxx explicit &lt;----------------------------- attempt to SSH using the identity file above
debug1: SSH2_MSG_EXT_INFO received
debug1: kex_input_ext_info: server-sig-algs=&lt;ssh-ed25519-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp256-cert-v01@openssh.com,sk-ssh-ed25519-cert-v01@openssh.com,sk-ecdsa-sha2-nistp256-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ssh-dss-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,sk-ecdsa-sha2-nistp256@openssh.com,ssh-ed25519,ecdsa-sha2-nistp521,ecdsa-sha2-nistp384,ecdsa-sha2-nistp256,rsa-sha2-512,rsa-sha2-256,ssh-rsa,ssh-dss&gt;
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug1: Authentications that can continue: publickey
debug1: Next authentication method: publickey
debug1: Offering public key: /Users/foo/.ssh/id_ed25519_id2 ED25519 SHA256:xxxx explicit &lt;----------------------------------------- using the identity file above
debug1: Server accepts key: /Users/foo/.ssh/id_ed25519_id2 ED25519 SHA256:xxxx explicit
debug1: Authentication succeeded (publickey).
Authenticated to github.com ([20.205.243.166]:22).
debug1: channel 0: new [client-session]
debug1: Entering interactive session.
debug1: pledge: filesystem full
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: client_input_hostkeys: searching /Users/foo/.ssh/known_hosts for github.com / (none)
debug1: client_input_hostkeys: searching /Users/foo/.ssh/known_hosts2 for github.com / (none)
debug1: client_input_hostkeys: hostkeys file /Users/foo/.ssh/known_hosts2 does not exist
debug1: client_input_hostkeys: no new or deprecated keys from server
debug1: Sending environment.
....
...
..
.
Transferred: sent 3664, received 190692 bytes, in 2.1 seconds
Bytes per second: sent 1735.8, received 90338.1
debug1: Exit status 0
Receiving objects: 100% (341/341), 172.98 KiB | 304.00 KiB/s, done.
Resolving deltas: 100% (127/127), done.
</code></pre><p>As annotated above, we can see how the identity file was selected based on the <code>Host</code> and used for cloning.</p>
<p>What happens if we use this configuration instead?</p>
<pre tabindex="0"><code># Account 1
Host github.com
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519_id1
  IdentitiesOnly yes
# Account 2
Host github.com
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519_id2
  IdentitiesOnly yes
</code></pre><p>In this example, we set the same <code>Host</code> for both configurations.</p>
<p>Let&rsquo;s clone account2&rsquo;s private repository again using <code>GIT_SSH_COMMAND=&quot;ssh -v&quot; git clone git@github:account2/account2.github.io.git</code>.</p>
<pre tabindex="0"><code>Cloning into &#39;account2.github.io&#39;...
OpenSSH_8.6p1, LibreSSL 2.8.3
debug1: Reading configuration data /Users/foo/.ssh/config
debug1: /Users/foo/.ssh/config line 1: Applying options for github.com &lt;----------------------------- found 2 matching configurations based on Host
debug1: /Users/foo/.ssh/config line 6: Applying options for github.com
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: /etc/ssh/ssh_config line 21: include /etc/ssh/ssh_config.d/* matched no files
debug1: /etc/ssh/ssh_config line 54: Applying options for *
debug1: Authenticator provider $SSH_SK_PROVIDER did not resolve; disabling
debug1: Connecting to github.com port 22.
debug1: Connection established.
debug1: identity file /Users/foo/.ssh/id_ed25519_id1 type 3 &lt;------------------------------------------------ identified the identity files
debug1: identity file /Users/foo/.ssh/id_ed25519_id1-cert type -1
debug1: identity file /Users/foo/.ssh/id_ed25519_id2 type 3
debug1: identity file /Users/foo/.ssh/id_ed25519_id2-cert type -1
debug1: Local version string SSH-2.0-OpenSSH_8.6
debug1: Remote protocol version 2.0, remote software version babeld-34bf8ec8
debug1: compat_banner: no match: babeld-34bf8ec8
debug1: Authenticating to github.com:22 as &#39;git&#39;
debug1: load_hostkeys: fopen /Users/foo/.ssh/known_hosts2: No such file or directory
debug1: load_hostkeys: fopen /etc/ssh/ssh_known_hosts: No such file or directory
debug1: load_hostkeys: fopen /etc/ssh/ssh_known_hosts2: No such file or directory
debug1: SSH2_MSG_KEXINIT sent
debug1: SSH2_MSG_KEXINIT received
debug1: kex: algorithm: curve25519-sha256
debug1: kex: host key algorithm: ssh-ed25519
debug1: kex: server-&gt;client cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none
debug1: kex: client-&gt;server cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none
debug1: expecting SSH2_MSG_KEX_ECDH_REPLY
debug1: SSH2_MSG_KEX_ECDH_REPLY received
debug1: Server host key: ssh-ed25519 SHA256:+xxxx
debug1: load_hostkeys: fopen /Users/foo/.ssh/known_hosts2: No such file or directory
debug1: load_hostkeys: fopen /etc/ssh/ssh_known_hosts: No such file or directory
debug1: load_hostkeys: fopen /etc/ssh/ssh_known_hosts2: No such file or directory
debug1: Host &#39;github.com&#39; is known and matches the ED25519 host key.
debug1: Found key in /Users/foo/.ssh/known_hosts:3
debug1: rekey out after 134217728 blocks
debug1: SSH2_MSG_NEWKEYS sent
debug1: expecting SSH2_MSG_NEWKEYS
debug1: SSH2_MSG_NEWKEYS received
debug1: rekey in after 134217728 blocks
debug1: Will attempt key: /Users/foo/.ssh/id_ed25519_id1 ED25519 SHA256:xxxx explicit
debug1: Will attempt key: /Users/foo/.ssh/id_ed25519_id2 ED25519 SHA256:xxxx explicit
debug1: SSH2_MSG_EXT_INFO received
debug1: kex_input_ext_info: server-sig-algs=&lt;ssh-ed25519-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp256-cert-v01@openssh.com,sk-ssh-ed25519-cert-v01@openssh.com,sk-ecdsa-sha2-nistp256-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ssh-dss-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,sk-ecdsa-sha2-nistp256@openssh.com,ssh-ed25519,ecdsa-sha2-nistp521,ecdsa-sha2-nistp384,ecdsa-sha2-nistp256,rsa-sha2-512,rsa-sha2-256,ssh-rsa,ssh-dss&gt;
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug1: Authentications that can continue: publickey
debug1: Next authentication method: publickey
debug1: Offering public key: /Users/foo/.ssh/id_ed25519_id1 ED25519 SHA256:xxxx explicit &lt;------------------------------ despite matching 2 configurations, SSH defaulted to using the 1st match found
debug1: Server accepts key: /Users/foo/.ssh/id_ed25519_id1 ED25519 SHA256:xxxx explicit
debug1: Authentication succeeded (publickey).
Authenticated to github.com ([20.205.243.166]:22).
debug1: channel 0: new [client-session]
debug1: Entering interactive session.
debug1: pledge: filesystem full
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: client_input_hostkeys: searching /Users/foo/.ssh/known_hosts for github.com / (none)
debug1: client_input_hostkeys: searching /Users/foo/.ssh/known_hosts2 for github.com / (none)
debug1: client_input_hostkeys: hostkeys file /Users/foo/.ssh/known_hosts2 does not exist
debug1: client_input_hostkeys: no new or deprecated keys from server
debug1: Sending environment.
....
...
..
.
ERROR: Repository not found.
debug1: channel 0: free: client-session, nchannels 1
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
debug1: fd 0 clearing O_NONBLOCK
Transferred: sent 2360, received 2416 bytes, in 0.6 seconds
Bytes per second: sent 4211.8, received 4311.8
debug1: Exit status 1
</code></pre><p>We can see that for this configuration, SSH will only use the first match found and you are out of luck if you want to clone using the second match.</p>
<hr>
<p>There&rsquo;s probably a few other ways to do this, such as creating custom <code>git clone</code> alias to reference the respective identity files but this is one way that works for me.</p>
<p>Hope it helps whoever that is reading this.</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/blog/tcp-window-size-mtu/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Difference between TCP window size &amp; MTU</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/blog/configuring-conntrack-eks/">
                  <span class="button__text">Configuring conntrack limits for EKS worker nodes</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        
      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span
          >© 2024 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script><script src="/searchbar.js"></script>
<script src="/toggle-image.js"></script>

      
    </div>

    
      
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-SX2DZ2KVGS"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-SX2DZ2KVGS');
        }
      </script>
    
  


    
  </body>
</html>
