<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Building my secondhand camera equipment pricing webapp ::
        jaanhio
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="When I was dabbling with photography a few years back, secondhand camera equipment forum ClubSNAP was where I frequented for my equipment needs. Buying a brand new equipment was simply too expensive for a hobbyist like me.
Finding sellers was the easy part; the difficult part was figuring how much to pay for it. What did I do? Manually scanned all the posts to figure out the &amp;ldquo;standard&amp;rdquo; price range of an equipment."
/>
<meta
  name="keywords"
  content="learnings"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/projects/sgcameraprice/" />





<link rel="stylesheet" href="/assets/style.css" />

<link rel="stylesheet" href="/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"><meta name="twitter:title" content="Building my secondhand camera equipment pricing webapp">
<meta name="twitter:description" content="When I was dabbling with photography a few years back, secondhand camera equipment forum ClubSNAP was where I frequented for my equipment needs. Buying a brand new equipment was simply too expensive for a hobbyist like me.
Finding sellers was the easy part; the difficult part was figuring how much to pay for it. What did I do? Manually scanned all the posts to figure out the &ldquo;standard&rdquo; price range of an equipment.">



<meta property="og:url" content="/projects/sgcameraprice/">
  <meta property="og:site_name" content="jaanhio">
  <meta property="og:title" content="Building my secondhand camera equipment pricing webapp">
  <meta property="og:description" content="When I was dabbling with photography a few years back, secondhand camera equipment forum ClubSNAP was where I frequented for my equipment needs. Buying a brand new equipment was simply too expensive for a hobbyist like me.
Finding sellers was the easy part; the difficult part was figuring how much to pay for it. What did I do? Manually scanned all the posts to figure out the “standard” price range of an equipment.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="projects">
    <meta property="article:published_time" content="2022-02-19T17:34:57+08:00">
    <meta property="article:modified_time" content="2022-02-19T17:34:57+08:00">
    <meta property="article:tag" content="Learnings">



<meta name="description" content="I write about tech and more!" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >$</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About me</a></li>
        
      
        
          <li><a href="/collection">Collection</a></li>
        
      
        
          <li><a href="/moments">Moments</a></li>
        
      
        
          <li><a href="/projects">Projects</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About me</a></li>
      
    
      
        <li><a href="/collection">Collection</a></li>
      
    
      
        <li><a href="/moments">Moments</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Building my secondhand camera equipment pricing webapp</h1>
    <div class="post-meta">
      
        <span class="post-date">
          6 Feb 2022
        </span>

        
      

      


      
        <span class="post-read-time"
          >— 7 min read</span
        >
      
    </div>

    
      <span class="post-tags">
        
          <a href="/tags/learnings/">#learnings</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p>When I was dabbling with photography a few years back, secondhand camera equipment forum <a href="https://www.clubsnap.com/">ClubSNAP</a> was where I frequented for my equipment needs. Buying a brand new equipment was simply too expensive for a hobbyist like me.</p>
<p>Finding sellers was the easy part; the difficult part was figuring how much to pay for it. What did I do? Manually scanned all the posts to figure out the &ldquo;standard&rdquo; price range of an equipment.</p>
<p>It was tedious and I thought to myself how great it would be if I can see the price history over time at a glance.</p>
<p>I decided to build it myself.</p>
<p>After spending 1.5 months working on it after work, it&rsquo;s finally up!</p>
<p>
  <img src="./sgcameraprice-usage.webp"  alt="usage-video"  class="center"  />


<a href="https://sgcameraprice.xyz/">SG secondhand camera equipment pricing</a></p>
<hr>
<h1 id="planning">Planning</h1>
<p>Before building this, I asked myself what did I want to get out of it:</p>
<ul>
<li>learn Golang</li>
<li>deliver a MVP that can showcase the feasibility of this idea</li>
<li>fully manage the infrastructure while keeping costs as low as possible. ideally the infrastructure can be easily reused for future projects</li>
</ul>
<h2 id="feature">Feature</h2>
<p>To be able to deliver value as quickly as possible, I narrowed down the available features based on this statement:</p>
<blockquote>
<p>As a user, I want to be able to search for the price history of a particular camera equipment belonging to a particular brand over a specific period of time, with the ability to dynamically zoom in on the data without performing additional queries. I also want to be able to perform more than 1 search at once to compare the results.</p>
</blockquote>
<h2 id="design">Design</h2>
<p>As mentioned above, one the goals was to learn Golang. I have read quite a bit of code written in Golang as I have to operate EKS clusters running observability related services (Prometheus stack) at work and when you encounter some behaviour that isn&rsquo;t well documented, the best way to find the answer is to read the source code, most of which are written in Golang. However I have never written much Golang before so I thought this might be a good chance to get my hands dirty and learn the intricacies of it.</p>

  <img src="./architecture.png"  alt="usage-video"  class="center"  />


<p>I decided to adopt the microservices approach and split the logic into 3 different services:</p>
<ul>
<li>Frontend written using React (JavaScript). This is then packaged into static files and served by <code>nginx</code>.</li>
<li>Backend API written using Nodejs (TypeScript)</li>
<li>Worker performing periodic scraping written in Golang. I found a pretty decent Golang package (<a href="https://github.com/gocolly/colly">Colly</a>)meant for web scraping purpose</li>
</ul>
<p>Reasons for doing so: ability to scale and make changes to services without affecting the other services. This is especially true for the scraper worker instance, which is designed to operate only with 1 instance running at all times to reduce the amount of load on the scraped website as much as possible. Redundancy is not necessary since it is not user facing and even in failure cases, data can eventually be recovered.</p>
<h4 id="using-kubernetes">Using Kubernetes</h4>
<p>Some of you might be thinking &ldquo;Kubernetes for such a simple webapp?!&rdquo;.</p>
<p>Kubernetes (or rather containers + orchestrators in general) is amazing and has changed the way we design our systems and manage workloads. One of the main draw to me is the ability to deploy any workload in the form of containers and not worry about messing up the dependencies of each application.</p>
<p>It also allows us to <a href="https://kubernetespodcast.com/episode/063-economics-of-kubernetes/">pack more within the same VMs</a>, which is what I am looking for as I intend to use this setup for my future projects. Future application deployments can be as simple as: purchasing new domain (if necessary), containerizing the new application, write a helm chart to create an necessary resources, deploy! Or put it simply, there&rsquo;s not much more tweaking left on the infrastructure.</p>
<p>Of course, nothing is free. With the features come complexity. To me, that&rsquo;s a fair tradeoff and if anything, it&rsquo;s a great opportunity to learn should I ever encounter any issue.</p>
<h4 id="cloud-provider">Cloud provider</h4>
<p>This took me awhile to decide due to the number of choices available (AWS, GCP, Azure, Digital Ocean, Linode, Heroku etc). Operating cost and ease of operating are what I based my decision on.</p>
<p>In terms of familiarity, AWS comes out top as I have been using their services almost daily for both my current and previous roles. The problem is the complexity and operating cost. Like Kubernetes, it has many knobs, perhaps a little too many for a small project like mine. Also, the operating cost is much higher with the lingering fear that I might have accidentally toggled some costly feature.</p>
<p>I ended up with either Linode or Digital Ocean. Both are rather similar in pricing and both provide managed Kubernetes control plane. However, Digital Ocean do provide managed databases though unlike Linode.</p>
<p>Eventually I chose Linode because they happen to have a $100 voucher for new joiners and I figured I can use this opportunity to learn how to operate a database (deployment, backups, upgrades) instead using <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSets</a>.</p>
<hr>
<h1 id="challenges-faced">Challenges faced</h1>
<h2 id="writing-scraper-in-golang">Writing scraper in Golang</h2>
<p>As someone who spent most of his time working with JavaScript, working with Golang was a rather refreshing change. It got me thinking about code differently, especially when it comes to error handling, Golang&rsquo;s design and convention encourages explicit checking of error where they occur. No more <code>try {} catch {}</code> &amp; <code>throw</code> to serve my error handling needs.</p>
<p>I also came to appreciate how simple setting up a Golang project is, especially with the &ldquo;batteries included&rdquo; philosophy. <a href="https://yolken.net/blog/golang-batteries-not-included">At least for my use case</a>.</p>
<p>In JavaScript, there are so many ways to do a certain task (e.g writing tests and linting) that more time was fighting decision fatigue than working on the application itself.</p>
<p>However for the scraping logic implementation, I did have to use a third party package <a href="https://github.com/gocolly/colly">colly</a>, and the experience was a little more painful than I expected it to be. Perhaps it&rsquo;s the lack of clear documentation on how various pieces of the package work. To be fair, the repository did come with <a href="https://github.com/gocolly/colly/tree/master/_examples">examples</a> but I still had to spend quite a bit of time figuring out how exactly can I use it to scrape a piece of data.</p>
<p>Then there&rsquo;s the console logging part.</p>
<p>In JavaScript, when you log something to the console, you can pretty much see the entire data structure of whatever you are logging and be able to drill down into any of the fields present. When it comes to web scraping that involves traversing the DOM, it helps greatly to be able to visualize where I am at.</p>
<pre tabindex="0"><code>{
    foo: {
        bar: {
            baz: 123
        }
    }
}
</code></pre><p>Using Golang and the colly package, what I got was something like this:</p>
<pre tabindex="0"><code>&amp;Node{0x0231231}&amp;prev{0x0231231}...
</code></pre><p>Perhaps I was logging in the wrong format?</p>
<h2 id="somewhat-securing-the-backend-api">(somewhat) Securing the backend API</h2>
<p>I don&rsquo;t think the data I have is of any value but it got me thinking about what are the available options to prevent misuse of the API. Most of the recommended approaches involve some sort of user authentication which I do not want to implement as I wanted to make it easy for people to access and use it.</p>
<p>In the end, I went for the <a href="https://securitytrails.com/blog/security-through-obscurity">&ldquo;security through obscurity&rdquo;</a> approach by obfuscating the frontend JavaScript code and added debug protection to deter most users from trying to reverse engineering the token generation logic.</p>
<p>Is it entirely secure? Of course not! This is just an experimentation.</p>
<p>What I am doing is just making the reverse engineering process as painful as possible for most people, such that the cost of reverse engineering it outweighs the benefit of it.</p>
<p>I am not a reverse engineer myself but I believe any RE worth their salt can easily figure it out, to which congratulations, you now have free access to the backend API.</p>
<hr>
<h1 id="further-improvements">Further improvements</h1>
<p>I see the current version as a MVP that can do with some improvements:</p>
<ul>
<li>making it mobile friendly. how can the UI, in particular the graph, be more pleasantly displayed for mobile users?</li>
<li>storing of queries when user returns so that they do not have to perform the same query again</li>
</ul>

    </div>
    

    
      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span
          >© 2024 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script><script src="/searchbar.js"></script>

      
    </div>

    
      
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-SX2DZ2KVGS"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-SX2DZ2KVGS');
        }
      </script>
    
  


    
  </body>
</html>
